<!DOCTYPE html>
<html lang="zh">

<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://cdn.bootcss.com/jquery/1.12.0/jquery.min.js"></script>
    <script src="/browser/script/miniUI37/miniui.js"></script>
    <link rel="stylesheet" type="text/css" href="../script/miniUI37/themes/default/miniui.css">
    <script src="../../dist/index.umd.js"></script>
    <script src='../component/modal.shelf.js' class="shelf-modal"></script>
    <script src='../component/detailSelect.shelf.js' class="shelf-detailSelect"></script>

    <title>Document</title>
    <script>

        var api = Api(function (ajax) {
            return {
                getData: function () {
                    return new Promise(function (res) {
                        res({
                            name: '黎万民',
                            birth: '1967-1-2',
                            sex: ['001', '男'],
                            tele: '027-87541110',
                            minzu: ['001', '汉族'],
                            phone: '13871085936',
                            px_start: '2003-1-2',
                            px_end: '2003-3-2',
                            unit: ['2003-3-2', '']
                        })
                    })
                }
            }
        })

        Shelf.done().then(function () {

            mini.parse()

            var form = Form({
                'birth': Form.Date({ request: true }),
                'status': Form.Select(),
                'sex': Form.Checkbox(),
                'tele': Form.Text(),
                'name': Form.Text(),
                'phone': Form.Text(),
                'minzu': Form.Radio(),
                'px_start': Form.Date({ request: true }),
                'px_end': Form.Date({ request: true }),
                'unit': Form.DetailSelect({ table: 'zb02' }),
            })

            mini.get('datagrid1').setColumns([{
                type: 'checkcolumn'
            }, {
                type: 'indexcolumn',
                header: '序号',
                width: '30'
            }, {
                field: 'time',
                header: '日期',
                width: '70'
            }, {
                field: 'name',
                header: '姓名',
                width: '70'
            }, {
                field: 'idnum',
                header: '证件号',
                width: '130'
            }, {
                field: 'content',
                header: '内容分类',
                width: '130'
            }, {
                field: 'place',
                header: '问题属地',
                width: '130'
            }, {
                field: 'status',
                header: '状态',
                width: '130',
                renderer: function (v) {
                    return v.value[1]
                }
            }, {
                field: 'opreate',
                header: "操作",
                renderer: function (arg) {
                    const row_data = arg.row
                    return Dom.async('<div><a class="inline_btn edit_btn">修改</a><a class="inline_btn delete_btn">删除</a></div>', function (dom) {
                        dom.querySelector('.edit_btn').onclick = function () {
                            Shelf.get('modal').open(
                                Dom(
                                    document.getElementById('l_form').innerHTML,
                                    function (dom) {

                                        var form = Form({
                                            'time': Form.Date({ request: true }),
                                            'name': Form.Text(),
                                            'idnum': Form.Text(),
                                            'content': Form.Text(),
                                            'place': Form.Text(),
                                            'status': Form.Select(),
                                        }, dom)

                                        form.setData(row_data)

                                        form.status.setOpions({
                                            '001': '已解决',
                                            '002': '选项2',
                                            '003': '选项3',
                                            '004': '选项4',
                                        })
                                        
                                    }), {
                                width: 360,
                                height: 480,
                                title: '编辑详情'
                            })
                        }
                        dom.querySelector('.delete_btn').onclick = function () {
                            alert(2)
                        }

                    })
                }
            }])

            mini.get('datagrid1').setData([{
                time: '2017-7-2',
                name: "叶剑英",
                idnum: "001",
                content: "其他",
                place: '埃尔新几内亚',
                status: [001, '已解决']
            }])

            api.getData().then(function (data) {

                form.setData(data)

                if (!form.birth.getValue()) {
                    form.birth.setValue('2017-7-1')
                }
                console.log(form)

                form.status.setOpions({
                    '001': '选项1',
                    '002': '选项2',
                    '003': '选项3',
                    '004': '选项4',
                })
                form.sex.setOpions({
                    '001': '男',
                    '002': '女'
                })
                form.minzu.setOpions({
                    '001': '汉族',
                    '002': '其他少数民族'
                })

            })

            window.getData = function () {
                return form.getData()
            }
        })

    </script>
</head>

<body>
    <div class="globe">
        <div class="head">
            <div class="row">
                <div class="btn_group right">
                    <a href="" class="block_btn">导出</a>
                    <a href="" class="block_btn disabled">保存</a>
                    <a href="" class="block_btn white">修改</a>
                    <a href="" class="block_btn">关闭</a>

                </div>
            </div>
        </div>
        <div class="body">
            <form class="common">
                <fieldset>
                    <legend>申请人信息</legend>
                    <div class="row">
                        <label class="col-2">姓名:</label>
                        <div class="col-4" data-name-name></div>
                        <label class="col-2">出生日期:</label>
                        <div class="col-4" data-name-birth></div>
                    </div>
                    <div class="row">
                        <label class="col-2">民族:</label>
                        <div class="col-4" data-name-minzu></div>
                        <label class="col-2">电话:</label>
                        <div class="col-4" data-name-tele></div>
                    </div>
                    <div class="row">
                        <label class="col-2">性别:</label>
                        <div class="col-4" data-name-sex></div>
                        <label class="col-2">手机号:</label>
                        <div class="col-4" data-name-phone></div>
                    </div>
                    <div class="row">
                        <label class="col-2">任职状态:</label>
                        <div class="col-4" data-name-status></div>
                        <label class="col-2">培训日期:</label>
                        <div class="col-4 flex-row">
                            <div style="flex: 1;" data-name-px_start></div>
                            <b>至</b>
                            <div style="flex: 1;" data-name-px_end></div>
                        </div>
                    </div>
                    <div class="row">
                        <label class="col-2">主管单位:</label>
                        <div class="col-4" data-name-unit></div>
                    </div>
                </fieldset>
                <fieldset>
                    <legend>申请人信息</legend>
                    <div class="row">
                        <div id="datagrid1" class="mini-datagrid" style="height:240px;">
                        </div>
                    </div>
                </fieldset>
                <fieldset>
                    <legend>申请人信息</legend>
                    <div class="row">
                        1
                    </div>
                    <div class="row">
                        2
                    </div>
                    <div class="row">
                        3
                    </div>
                    <div class="row">
                        4
                    </div>
                </fieldset>
                <fieldset>
                    <legend>申请人信息</legend>
                    <div class="row">
                        1
                    </div>
                    <div class="row">
                        2
                    </div>
                    <div class="row">
                        3
                    </div>
                    <div class="row">
                        4
                    </div>
                </fieldset>
            </form>

        </div>
    </div>


    <div class="template" style="display: none;">
        <div id="l_form">
            <div class="panel">
                <div class="body">
                    <form class="mini" style="width: 100%;">
                        <fieldset>
                            <legend>申请人信息</legend>
                            <div class="row">
                                <label class="col-3">日期:</label>
                                <div class="col-9" data-name-time></div>
                            </div>
                            <div class="row">
                                <label class="col-3">姓名:</label>
                                <div class="col-9" data-name-name></div>
                            </div>
                            <div class="row">
                                <label class="col-3">证件号:</label>
                                <div class="col-9" data-name-idnum></div>
                            </div>
                            <div class="row">
                                <label class="col-3">内容分类:</label>
                                <div class="col-9" data-name-content></div>
                            </div>
                            <div class="row">
                                <label class="col-3">问题属地:</label>
                                <div class="col-9" data-name-place></div>
                            </div>
                            <div class="row">
                                <label class="col-3">状态:</label>
                                <div class="col-9" data-name-status></div>
                            </div>
                        </fieldset>
                    </form>
                </div>
                <div class="foot">
                    <div class="row">
                        <div class="btn_group right">
                            <a href="" class="block_btn">导出</a>
                            <a href="" class="block_btn disabled">保存</a>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</body>



</html>